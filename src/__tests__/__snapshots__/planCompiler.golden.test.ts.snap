// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`plan compiler golden outputs > renders stable plan outputs for the git-commit-push preset 1`] = `
"Commit & Push (git-commit-push) — target mode: dry-run

Flow: git-commit-push
  - [prompt:input] choose-commit-file
    question: Path to the commit message file?
    default answer: 
  - [message] warning
    level: info
    text: Dev Wizard will run \`git add .\`, \`git commit -F <file>\`, and \`git push\`. Make sure your current branch and remote are correct before continuing.

  - [command] commit-and-push
    • git add .
    • git commit -F ""
    • git push
  - [prompt:confirm] clear-message-confirm
    question: Clear the commit message file after a successful push?
    default answer: false
  - [branch] clear-message-routing
    branch rationales: (hidden — use --plan-expand branches)
    default → complete
    selected → complete
  - [message] complete
    level: success
    text: Git commit workflow complete.
"
`;

exports[`plan compiler golden outputs > renders stable plan outputs for the git-commit-push preset 2`] = `
"{"type":"plan.meta","data":{"scenarioId":"git-commit-push","scenarioLabel":"Commit & Push","targetMode":"dry-run"}}
{"type":"plan.flow","flowId":"git-commit-push","data":{"stepCount":7,"nested":false}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"choose-commit-file","data":{"kind":"prompt","mode":"input","answerSource":"default","required":false}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"warning","data":{"kind":"message"}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"commit-and-push","data":{"kind":"command","commandCount":3}}
{"type":"plan.command","flowId":"git-commit-push","stepId":"commit-and-push","data":{"index":0,"run":"git add ."}}
{"type":"plan.command","flowId":"git-commit-push","stepId":"commit-and-push","data":{"index":1,"run":"git commit -F \\"\\""}}
{"type":"plan.command","flowId":"git-commit-push","stepId":"commit-and-push","data":{"index":2,"run":"git push"}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"clear-message-confirm","data":{"kind":"prompt","mode":"confirm","answerSource":"default","required":false}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"clear-message-routing","data":{"kind":"branch","selectedTarget":"complete"}}
{"type":"plan.step","flowId":"git-commit-push","stepId":"complete","data":{"kind":"message"}}
{"type":"plan.preferences","data":{"expandEnv":false,"expandTemplates":false,"expandBranches":false}}
{"type":"plan.summary","data":{"warnings":[],"pendingPromptCount":0}}"
`;

exports[`plan compiler golden outputs > renders stable plan outputs for the git-commit-push preset 3`] = `
"{
  "scenarioId": "git-commit-push",
  "scenarioLabel": "Commit & Push",
  "scenarioDescription": "Stage all changes, commit using the contents of a commit message file, push to the configured remote, and optionally clear the message file afterward.\\n",
  "targetMode": "dry-run",
  "overrides": [],
  "warnings": [],
  "pendingPromptCount": 0,
  "preferences": {
    "expandEnv": false,
    "expandTemplates": false,
    "expandBranches": false
  },
  "flows": [
    {
      "id": "git-commit-push",
      "steps": [
        {
          "kind": "prompt",
          "id": "choose-commit-file",
          "mode": "input",
          "prompt": "Path to the commit message file?",
          "answer": "",
          "answerSource": "default",
          "required": false,
          "dynamic": false,
          "defaultValue": ""
        },
        {
          "kind": "message",
          "id": "warning",
          "level": "info",
          "text": "Dev Wizard will run \`git add .\`, \`git commit -F <file>\`, and \`git push\`. Make sure your current branch and remote are correct before continuing.\\n"
        },
        {
          "kind": "command",
          "id": "commit-and-push",
          "commands": [
            {
              "index": 0,
              "run": "git add .",
              "continueOnFail": false
            },
            {
              "index": 1,
              "run": "git commit -F \\"\\"",
              "continueOnFail": false
            },
            {
              "index": 2,
              "run": "git push",
              "continueOnFail": false
            }
          ]
        },
        {
          "kind": "prompt",
          "id": "clear-message-confirm",
          "mode": "confirm",
          "prompt": "Clear the commit message file after a successful push?",
          "answer": false,
          "answerSource": "default",
          "required": false,
          "dynamic": false,
          "defaultValue": false
        },
        {
          "kind": "branch",
          "id": "clear-message-routing",
          "branches": [
            {
              "expression": "false",
              "result": false,
              "target": "clear-message-file"
            }
          ],
          "defaultTarget": "complete",
          "selectedTarget": "complete"
        },
        {
          "kind": "message",
          "id": "complete",
          "level": "success",
          "text": "Git commit workflow complete."
        }
      ]
    }
  ],
  "events": [
    {
      "type": "plan.meta",
      "data": {
        "scenarioId": "git-commit-push",
        "scenarioLabel": "Commit & Push",
        "targetMode": "dry-run"
      }
    },
    {
      "type": "plan.flow",
      "flowId": "git-commit-push",
      "data": {
        "stepCount": 7,
        "nested": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "choose-commit-file",
      "data": {
        "kind": "prompt",
        "mode": "input",
        "answerSource": "default",
        "required": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "warning",
      "data": {
        "kind": "message"
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "commit-and-push",
      "data": {
        "kind": "command",
        "commandCount": 3
      }
    },
    {
      "type": "plan.command",
      "flowId": "git-commit-push",
      "stepId": "commit-and-push",
      "data": {
        "index": 0,
        "run": "git add ."
      }
    },
    {
      "type": "plan.command",
      "flowId": "git-commit-push",
      "stepId": "commit-and-push",
      "data": {
        "index": 1,
        "run": "git commit -F \\"\\""
      }
    },
    {
      "type": "plan.command",
      "flowId": "git-commit-push",
      "stepId": "commit-and-push",
      "data": {
        "index": 2,
        "run": "git push"
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "clear-message-confirm",
      "data": {
        "kind": "prompt",
        "mode": "confirm",
        "answerSource": "default",
        "required": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "clear-message-routing",
      "data": {
        "kind": "branch",
        "selectedTarget": "complete"
      }
    },
    {
      "type": "plan.step",
      "flowId": "git-commit-push",
      "stepId": "complete",
      "data": {
        "kind": "message"
      }
    }
  ]
}
"
`;

exports[`plan compiler golden outputs > renders stable plan outputs for the sample scenario 1`] = `
"Hello World (hello-world) — target mode: dry-run

Flow: hello-flow
  - [group] shared-intro → flow shared-welcome
      - [message] shared-message
        level: info
        text: This message comes from the shared flow import.
  - [prompt:input] ask-name
    question: What is your name?
    default answer: codex
  - [prompt:confirm] confirm-greeting
    question: Print a greeting for codex?
    default answer: true
  - [branch] should-greet
    branch rationales: (hidden — use --plan-expand branches)
    default → failure-demo-intro
    selected → run-greeting
  - [command] run-greeting
    • echo "Hello codex!"
  - [message] failure-demo-intro
    level: info
    text: Optional: simulate a failure to see retry/skip behaviour.
  - [prompt:confirm] ask-simulate-failure
    question: Simulate a failing command?
    default answer: false
  - [branch] branch-simulate-failure
    branch rationales: (hidden — use --plan-expand branches)
    default → finish
    selected → finish
  - [message] finish
    level: success
    text: All done! Thanks for visiting, codex.

Flow: post-run-notes
  - [message] recap
    level: info
    text: Follow-up flow: we ran  step(s) and recorded your name as codex.
  - [command] recap-command
    • echo "Chained flow executed after hello-flow."
"
`;

exports[`plan compiler golden outputs > renders stable plan outputs for the sample scenario 2`] = `
"{"type":"plan.meta","data":{"scenarioId":"hello-world","scenarioLabel":"Hello World","targetMode":"dry-run"}}
{"type":"plan.flow","flowId":"hello-flow","data":{"stepCount":10,"nested":false}}
{"type":"plan.flow","flowId":"shared-welcome","data":{"stepCount":1,"nested":true}}
{"type":"plan.step","flowId":"shared-welcome","stepId":"shared-message","data":{"kind":"message"}}
{"type":"plan.step","flowId":"hello-flow","stepId":"shared-intro","data":{"kind":"group","flowId":"shared-welcome"}}
{"type":"plan.step","flowId":"hello-flow","stepId":"ask-name","data":{"kind":"prompt","mode":"input","answerSource":"default","required":true}}
{"type":"plan.step","flowId":"hello-flow","stepId":"confirm-greeting","data":{"kind":"prompt","mode":"confirm","answerSource":"default","required":false}}
{"type":"plan.step","flowId":"hello-flow","stepId":"should-greet","data":{"kind":"branch","selectedTarget":"run-greeting"}}
{"type":"plan.step","flowId":"hello-flow","stepId":"run-greeting","data":{"kind":"command","commandCount":1}}
{"type":"plan.command","flowId":"hello-flow","stepId":"run-greeting","data":{"index":0,"run":"echo \\"Hello codex!\\""}}
{"type":"plan.step","flowId":"hello-flow","stepId":"failure-demo-intro","data":{"kind":"message"}}
{"type":"plan.step","flowId":"hello-flow","stepId":"ask-simulate-failure","data":{"kind":"prompt","mode":"confirm","answerSource":"default","required":false}}
{"type":"plan.step","flowId":"hello-flow","stepId":"branch-simulate-failure","data":{"kind":"branch","selectedTarget":"finish"}}
{"type":"plan.step","flowId":"hello-flow","stepId":"finish","data":{"kind":"message"}}
{"type":"plan.flow","flowId":"post-run-notes","data":{"stepCount":2,"nested":false}}
{"type":"plan.step","flowId":"post-run-notes","stepId":"recap","data":{"kind":"message"}}
{"type":"plan.step","flowId":"post-run-notes","stepId":"recap-command","data":{"kind":"command","commandCount":1}}
{"type":"plan.command","flowId":"post-run-notes","stepId":"recap-command","data":{"index":0,"run":"echo \\"Chained flow executed after hello-flow.\\""}}
{"type":"plan.preferences","data":{"expandEnv":false,"expandTemplates":false,"expandBranches":false}}
{"type":"plan.summary","data":{"warnings":[],"pendingPromptCount":0}}"
`;

exports[`plan compiler golden outputs > renders stable plan outputs for the sample scenario 3`] = `
"{
  "scenarioId": "hello-world",
  "scenarioLabel": "Hello World",
  "scenarioDescription": "Demonstrates prompts, commands, templating, and shared flows.",
  "targetMode": "dry-run",
  "overrides": [],
  "warnings": [],
  "pendingPromptCount": 0,
  "preferences": {
    "expandEnv": false,
    "expandTemplates": false,
    "expandBranches": false
  },
  "flows": [
    {
      "id": "hello-flow",
      "steps": [
        {
          "kind": "group",
          "id": "shared-intro",
          "flowId": "shared-welcome",
          "plan": {
            "id": "shared-welcome",
            "steps": [
              {
                "kind": "message",
                "id": "shared-message",
                "level": "info",
                "text": "This message comes from the shared flow import."
              }
            ]
          }
        },
        {
          "kind": "prompt",
          "id": "ask-name",
          "mode": "input",
          "prompt": "What is your name?",
          "answer": "codex",
          "answerSource": "default",
          "required": true,
          "dynamic": false,
          "defaultValue": "codex"
        },
        {
          "kind": "prompt",
          "id": "confirm-greeting",
          "mode": "confirm",
          "prompt": "Print a greeting for codex?",
          "answer": true,
          "answerSource": "default",
          "required": false,
          "dynamic": false,
          "defaultValue": true
        },
        {
          "kind": "branch",
          "id": "should-greet",
          "branches": [
            {
              "expression": "answers.sendGreeting === true",
              "result": true,
              "target": "run-greeting"
            }
          ],
          "defaultTarget": "failure-demo-intro",
          "selectedTarget": "run-greeting"
        },
        {
          "kind": "command",
          "id": "run-greeting",
          "commands": [
            {
              "index": 0,
              "run": "echo \\"Hello codex!\\"",
              "continueOnFail": false
            }
          ]
        },
        {
          "kind": "message",
          "id": "failure-demo-intro",
          "level": "info",
          "text": "Optional: simulate a failure to see retry/skip behaviour."
        },
        {
          "kind": "prompt",
          "id": "ask-simulate-failure",
          "mode": "confirm",
          "prompt": "Simulate a failing command?",
          "answer": false,
          "answerSource": "default",
          "required": false,
          "dynamic": false,
          "defaultValue": false
        },
        {
          "kind": "branch",
          "id": "branch-simulate-failure",
          "branches": [
            {
              "expression": "answers.simulateFailure === true",
              "result": false,
              "target": "failing-command"
            }
          ],
          "defaultTarget": "finish",
          "selectedTarget": "finish"
        },
        {
          "kind": "message",
          "id": "finish",
          "level": "success",
          "text": "All done! Thanks for visiting, codex."
        }
      ]
    },
    {
      "id": "post-run-notes",
      "steps": [
        {
          "kind": "message",
          "id": "recap",
          "level": "info",
          "text": "Follow-up flow: we ran  step(s) and recorded your name as codex."
        },
        {
          "kind": "command",
          "id": "recap-command",
          "commands": [
            {
              "index": 0,
              "run": "echo \\"Chained flow executed after hello-flow.\\"",
              "continueOnFail": false
            }
          ]
        }
      ]
    }
  ],
  "events": [
    {
      "type": "plan.meta",
      "data": {
        "scenarioId": "hello-world",
        "scenarioLabel": "Hello World",
        "targetMode": "dry-run"
      }
    },
    {
      "type": "plan.flow",
      "flowId": "hello-flow",
      "data": {
        "stepCount": 10,
        "nested": false
      }
    },
    {
      "type": "plan.flow",
      "flowId": "shared-welcome",
      "data": {
        "stepCount": 1,
        "nested": true
      }
    },
    {
      "type": "plan.step",
      "flowId": "shared-welcome",
      "stepId": "shared-message",
      "data": {
        "kind": "message"
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "shared-intro",
      "data": {
        "kind": "group",
        "flowId": "shared-welcome"
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "ask-name",
      "data": {
        "kind": "prompt",
        "mode": "input",
        "answerSource": "default",
        "required": true
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "confirm-greeting",
      "data": {
        "kind": "prompt",
        "mode": "confirm",
        "answerSource": "default",
        "required": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "should-greet",
      "data": {
        "kind": "branch",
        "selectedTarget": "run-greeting"
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "run-greeting",
      "data": {
        "kind": "command",
        "commandCount": 1
      }
    },
    {
      "type": "plan.command",
      "flowId": "hello-flow",
      "stepId": "run-greeting",
      "data": {
        "index": 0,
        "run": "echo \\"Hello codex!\\""
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "failure-demo-intro",
      "data": {
        "kind": "message"
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "ask-simulate-failure",
      "data": {
        "kind": "prompt",
        "mode": "confirm",
        "answerSource": "default",
        "required": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "branch-simulate-failure",
      "data": {
        "kind": "branch",
        "selectedTarget": "finish"
      }
    },
    {
      "type": "plan.step",
      "flowId": "hello-flow",
      "stepId": "finish",
      "data": {
        "kind": "message"
      }
    },
    {
      "type": "plan.flow",
      "flowId": "post-run-notes",
      "data": {
        "stepCount": 2,
        "nested": false
      }
    },
    {
      "type": "plan.step",
      "flowId": "post-run-notes",
      "stepId": "recap",
      "data": {
        "kind": "message"
      }
    },
    {
      "type": "plan.step",
      "flowId": "post-run-notes",
      "stepId": "recap-command",
      "data": {
        "kind": "command",
        "commandCount": 1
      }
    },
    {
      "type": "plan.command",
      "flowId": "post-run-notes",
      "stepId": "recap-command",
      "data": {
        "index": 0,
        "run": "echo \\"Chained flow executed after hello-flow.\\""
      }
    }
  ]
}
"
`;
